<extend name="Layout:layout" />
<block name="content">
	<!--<div class="row">
		<div class="col-lg-12">
            <h1 class="page-header">订单号审核  </h1>
	    </div>
	</div>-->
	<style type="text/css">
		.layui-layer-ico{ background-position: 5px -39px;}
	</style>
	<nav class="breadcrumb" style="padding: 0px 15px; line-height: 37px; border-radius: 0; border-bottom: 1px solid #ddd; position: absolute;top: 0;left: 0;width: 100%;"><i class="fa fa-home"></i> 首页 <span class="c-gray en">&gt;</span> 试用管理 <span class="c-gray en">&gt;</span> 商品开奖 <a class="btn btn-success radius r" style="margin-top:1px;float: right;padding: 6px 20px;" href="javascript:location.replace(location.href);" title="刷新" ><i class="fa fa-refresh"></i></a><div style="clear: both;"></div></nav>
	<div style="height: 50px; width: 100%;"></div>
	<div class="panel panel-default">
		<!-- /.panel-heading -->
		<div class="panel-body">
			<div id="dataTables-example_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
				<div class="row">
					<div class="col-sm-12">
						<form class="form-inline" role="form" action="{:U('Probation/lottery_data')}" style="float: right; margin-bottom: 10px;" method="post">
						  <div class="form-group">
						    <label class="" for="name" style="margin-right: 15px;">今日剩余开奖人数：{$today}</label>
						    <input type="text" name="num" class="form-control" id="name" placeholder="请输入开奖人数" />
						    <input type="hidden" name="gid" value="{$gid}">
						  </div>
						  <button type="submit" class="btn btn-success">随机开奖</button>
						</form>
						<table class="table table-striped table-bordered table-hover dataTable no-footer dtr-inline" id="dataTables-example" role="grid" aria-describedby="dataTables-example_info" style="width: 100%;" width="100%">
							<thead >
								<tr role="row">
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 60px;" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">商品ID</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 70px;" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">商品主图</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 90px;" aria-label="Platform(s): activate to sort column ascending">试用标题</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 60px;" aria-label="Browser: activate to sort column ascending">试客ID</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 85px;" aria-label="Platform(s): activate to sort column ascending">申请时间</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 100px;" aria-label="Platform(s): activate to sort column ascending">用户</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 80px;" aria-label="Platform(s): activate to sort column ascending">淘宝号/QQ</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 70px;" aria-label="Platform(s): activate to sort column ascending">淘气值</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 80px;" aria-label="Platform(s): activate to sort column ascending">状态</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 80px;" aria-label="Platform(s): activate to sort column ascending">宝贝加购图</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 80px;" aria-label="Platform(s): activate to sort column ascending">操作</th>

								</tr>
							</thead>
							<tbody class="layui-table">
									<foreach name="list" item="vo">
									<tr>
									<td class="sorting_1">{$vo.gid}</td>
									<td><img style="width: 80px;height: 80px;" src="{$goods.image}" alt=""></td>
									<td scope="col" style="word-break: break-all;">{$goods.gname}</td>
									<td>{$vo.uid}</td>
									<td>{$vo.addtime}</td>
									<td>{$vo.ddusername}</td>
									<td>淘宝号：{$vo.tb_id}<br>QQ：{$vo.qq}</td>
									<td>
										<div class="img123" style="position: relative;width: 80px;height: 80px">
    										<img style="width: 80px;height: 80px" src="{$vo.img2}" alt="" title="点击查看" data-type="1">
    										<span style="display: inline-block; color:gray; width: 100%; height: 100%; position: absolute; display: none; text-align: center; top: 0; cursor: pointer;  line-height: 80px; font-size: 14px;">点击查看</span>
</div>
									</td>
									<td>第<?php if($vo['comfirm']==99){echo '一';}elseif($vo['comfirm']==101){echo '二';}elseif($vo['comfirm']==102){echo '三';}?>次申请</td>
									<td>
										<div class="img123" style="position: relative;width: 80px;height: 80px">
    										<img style="width: 80px;height: 80px" src="{$vo.cart_pic}" alt="" title="点击查看" data-type="2">
    										<span style="display: inline-block; color:gray; width: 100%; height: 100%; position: absolute; display: none; text-align: center; top: 0; cursor: pointer;  line-height: 80px; font-size: 14px;">点击查看</span>
</div>
									</td>
									<td scope="col" style="text-align: center;"><button class="btn btn-success" onclick="orders({$vo.id},1)" style="margin-bottom: 10px;">确认开奖</button><br /><button onclick="orders({$vo.id},2)" class="btn btn-warning">未中奖</button></td>
									</tr>
									</foreach>
							</tbody>
						</table>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<div class="dataTables_info" id="dataTables-example_info" role="status" aria-live="polite">显示  {$pagination.startRecord} 至 {$pagination.endRecord} 全部 {$pagination.totalCount} 条</div>
					</div>
					<div class="col-sm-6">
						<div class="dataTables_paginate paging_simple_numbers" id="dataTables-example_paginate">
							<ul class="pagination" id="list-pagination">
							</ul>
						</div>
					</div>
				</div>
			</div>
			<!-- /.table-responsive -->

		</div>
		<!-- /.panel-body -->
	</div>



</block>
<block name="otherfoot">
	<script src="__PUBLIC__/maoke/js/dist/layer.js" type="text/javascript" charset="utf-8"></script>
	<script>
	$(function(){
		$(".layui-table tr td").on('mouseover','.img123',function(){
			$(this).children('span').css('display','inline-block');
		})
		$(".layui-table tr td").on('mouseleave','.img123',function(){
			$(this).children('span').css('display','none');
		})
		$(".layui-table tr td").on('click','.img123',function(){
                var carImg = new Image();
			 	carImg.src = $(this).children('img').attr("src");
			 	var imgType = $(this).children('img').data("type");
			 	var tishi = imgType == 1?'淘气值截图':'宝贝加购截图';
			 	setTimeout(function(){
					var imgHeight = carImg.height ;
			 		var imgWidth = carImg.width;
			 		var obj = {
				 		type: 1,
				        title:tishi,
				        shadeClose: true,
				        closeBtn: true
				 	}
				 	if(imgWidth >= imgHeight){
				 		obj.area = ['460px'];
				 		obj.content = '<img src="'+carImg.src+'" alt="加载失败" width="100%"></img>';
				 	}else{
				 		obj.area = ['375px','667px'];
				 		obj.content = '<img src="'+carImg.src+'" alt="加载失败" width="100%" height="100%"></img>';
				 	}
				 	layer.open(obj);
				 	},
				100);
            }
		)
		var paginationOptions= $.extend(true, {$pagination|json_encode} ,
							{
									onPageClick: function (event, page) {
										var options = $(this).data('twbsPagination').options;
								        options.baseUrl = options.baseUrl.replace('','');
								        options.getParams.page = page;
//								        options.getParams.pagesize = options.getParams.pagesize;
                                        var param = '';
										for(var x in options.getParams ){
								        		param += '&' + x + '=' + options.getParams[x];
								        }
//										console.log(param);return;

								        window.location.href =  options.baseUrl + param + '';
								    }
							});
		$('#list-pagination').twbsPagination(paginationOptions);

	});

	function orders(id,status) {
		$.post(
	            "{:U('Ajaxlottery')}",
	            {id: id,status:status},
	            function (data) {
	                if (data.code == 1) {
	                    alert(data.msg);
	                    window.location.reload();
	                } else {
	                    alert(data.msg);
	                }
	            }
	        )

    }
	</script>




</block>