<extend name="Layout:layout" />
<block name="content">
	<!--<div class="row">
		<div class="col-lg-12">
	                    <h1 class="page-header">全站商品 </h1>
	    </div>
	</div>-->
	<nav class="breadcrumb" style="padding: 0px 15px; line-height: 37px; border-radius: 0; border-bottom: 1px solid #ddd; position: absolute;top: 0;left: 0;width: 100%;"><i class="fa fa-home"></i> 首页 <span class="c-gray en">&gt;</span> 专题管理 <span class="c-gray en">&gt;</span> 商品列表 <a class="btn btn-success radius r" style="margin-top:1px;float: right;padding: 6px 20px;" href="javascript:location.replace(location.href);" title="刷新" ><i class="fa fa-refresh"></i></a><div style="clear: both;"></div></nav>
	<div style="height: 50px; width: 100%;"></div>
	<div class="panel panel-default">

		<!-- /.panel-heading -->
		<div class="panel-body">
			<div id="dataTables-example_wrapper" class="dataTables_wrapper  dt-bootstrap no-footer">
			<div class="row">
				<form role="form" action="" method="get">
					<input type="hidden" name="m" value="Admin">
					<input type="hidden" name="c" value="SubjGoods">
					<input type="hidden" name="a" value="index">
					<div style="float: right;padding:0 15px; margin-bottom: 15px;" >
						<div style="width: 150px; float: left;">
							<label  style="float: left; line-height: 35px; margin-right: 10px;">分类</label>
							<select name="cid" style="width: 100px;display: block;height: 34px;padding: 6px 12px;font-size: 14px;line-height: 1.42857143;color: #555;background-color: #fff;background-image: none;border: 1px solid #ccc;border-radius: 4px;">
								<option value="">请选择</option>
								<foreach name="category" item="vo" key="k">
									<option value="{$k}" <if condition="$k eq $cid">selected</if> >{$vo}</option>
								</foreach>
						</foreach>
							</select>
						</div>
						<div style="width: 175px; float: left;">
							<label  style="float: left; line-height: 35px; margin-right: 10px;">券后价</label>
							<select name="price" style="width: 115px;display: block;height: 34px;padding: 6px 12px;font-size: 14px;line-height: 1.42857143;color: #555;background-color: #fff;background-image: none;border: 1px solid #ccc;border-radius: 4px;">
								<option value="">请选择</option>
								<foreach name="discount_price" item="vo" key="k">
									<option value="{$k}" <if condition="$k eq $price">selected</if> >{$vo}</option>
								</foreach>
						</foreach>
							</select>
						</div>
						<div style="width: 205px; float: left;">
							<label  style="float: left; line-height: 35px; margin-right: 10px;">优惠幅度</label>
							<select name="range" style="width: 115px;display: block;height: 34px;padding: 6px 12px;font-size: 14px;line-height: 1.42857143;color: #555;background-color: #fff;background-image: none;border: 1px solid #ccc;border-radius: 4px;">
								<option value="">请选择</option>
									<foreach name="ranges" item="vo" key="k">
										<option value="{$k}" <if condition="$k eq $range">selected</if> >{$vo}</option>
									</foreach>
						</foreach>
							</select>
						</div>
						<div style="width: 190px; float: left;">
							<label  style="float: left; line-height: 35px; margin-right: 10px;">有效时间</label>
							<select name="timenum" style="width: 100px;display: block;height: 34px;padding: 6px 12px;font-size: 14px;line-height: 1.42857143;color: #555;background-color: #fff;background-image: none;border: 1px solid #ccc;border-radius: 4px;">
								<option value="">请选择</option>
									<foreach name="effetime" item="vo" key="k">
										<option value="{$k}" <if condition="$k eq $timenum">selected</if> >{$vo}</option>
									</foreach>
						</foreach>
							</select>
						</div>
						<div style="width: 200px;float: left;">
							<label style="float: left; line-height: 35px;margin-right: 10px;">商品标题</label>
							<input name="keywords" value="{$keywords}" type="text"  style="width: 120px; height: 34px;padding: 6px 12px;font-size: 14px;line-height: 1.42857143;color: #555;background-color: #fff;background-image: none;border: 1px solid #ccc;border-radius: 4px;"/>
						</div>
						<div style="width: 60px; float: left;">
							<input type="submit" name="" id="" value="搜索" class="form-control btn btn-success"/>
						</div>
					</div>
				</form>
			</div>
			
				<form role="form" action="{:U(editSubjGoods)}" method="post">
				<div class="row">
					<div class="col-sm-12">
						<table class="table table-striped table-bordered table-hover dataTable no-footer dtr-inline" id="dataTables-example" role="grid" aria-describedby="dataTables-example_info" style="width: 100%;" width="100%">
							<thead>
								<tr role="row">
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 5%;" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">选择</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 5%;" aria-label="Browser: activate to sort column ascending">分类</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 25%;" aria-label="Browser: activate to sort column ascending">名称</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 15%px;" aria-label="Platform(s): activate to sort column ascending">商品图片</th>	
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 5%px;" aria-label="Platform(s): activate to sort column ascending">券后价</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 5%px;" aria-label="Platform(s): activate to sort column ascending">券值</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 5%px;" aria-label="Platform(s): activate to sort column ascending">优惠幅度</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 10%px;" aria-label="Platform(s): activate to sort column ascending">有效时间</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 5%px;" aria-label="Platform(s): activate to sort column ascending">专题</th>
									<th class="" tabindex="0" aria-controls="dataTables-example" rowspan="1" colspan="1" style="width: 10%px;" aria-label="CSS grade: activate to sort column ascending">操作</th>
								</tr>
							</thead>
							<tbody>
								<foreach name="list" item="vo" key="k">
									<tr>
									<td class="sorting_1"><input class="checkbox-li" name="goods_id[]" type="checkbox" value="{$vo.id}" /></td>
									<td ><?php $cid=empty($vo['cid'])?10016:$vo['cid']; echo $category[$cid];?></td>
									<td><a href="{$vo.url}" target="view_window">{$vo.title}</a></td>
									<td><img style="width:100px" alt="无法加载图片" src="{$vo.img}"></td>
									<td>{$vo['discount_price']-$vo['price_jian']}</td>
									<td>{$vo['price_jian']}</td>
									<td><?php echo round($vo['price_jian']/$vo['discount_price']*100,2).'%';?></td>
									<!--<td><?php if($vo['subj_seat']) echo $vo['subj_seat'];?></td>-->
									<td><?php echo diffdate($vo['endtime'])?></td>
									<td>{$subj_name[$vo['subj_id']]}</td>
									<td class="center" >
										<!--<a href="<?php echo U('SubjGoods/editSubjGoods' , array('id'=>$vo['id']) );?>"><button type="button" class="btn btn-primary">编辑</button></a>-->
										<a href="<?php echo U('SubjGoods/del' , array('id'=>$vo['id']) );?>"><button type="button" class="btn btn-primary">取消</button></a>
										<!--<a href="javascript:alert('暂不支持删除!');"><button type="button" class="btn btn-danger">删除</button></a>-->
									</td>
									</tr>
								</foreach>
							</tbody>
						</table>
					</div>
				</div>

				<div class="row">
						<div style="float: left; padding: 0 15px;">
							<div  style="line-height: 35px; float: left; margin-right: 20px;">
								<input type="checkbox" name="" id="all-check" value="" style="float: left;margin-top: 10px;margin-right: 5px;"/>全选
							</div>
							<div style="width: 160px; float: left; margin-right: 20px;">
								<label  style="float: left; line-height: 35px; margin-right: 10px;">专题</label>
								<select name="subjid" style="width: 120px;display: block;height: 34px;padding: 6px 12px;font-size: 14px;line-height: 1.42857143;color: #555;background-color: #fff;background-image: none;border: 1px solid #ccc;border-radius: 4px;">
									<option value="" >选择专题</option>
									<foreach name="subj" item="vo" key="k">
										<option value="{$vo.id}">{$vo.name}</option>
									</foreach>
								</select>
							</div>
							<div style="width: 60px; float: left;">
								<input type="submit" name="" id="" value="提交" class="form-control btn btn-success" />
							</div>
						</div>
				</div>
				
				</form>
				<div class="row">
					<div class="col-sm-6">
						<div class="dataTables_info" id="dataTables-example_info" role="status" aria-live="polite">显示  {$pagination.startRecord} 至 {$pagination.endRecord} 全部 {$pagination.totalCount} 条</div>
					</div>
					<div class="col-sm-6">
						<div class="dataTables_paginate paging_simple_numbers" id="dataTables-example_paginate">
							<ul class="pagination" id="list-pagination">
							</ul>
						</div>
					</div>
				</div>
			</div>
			<!-- /.table-responsive -->

		</div>
		<!-- /.panel-body -->
	</div>


</block>
<block name="otherfoot">
	<script>
	$(function(){	
		var paginationOptions= $.extend(true, {$pagination|json_encode} , 
							{
									onPageClick: function (event, page) {
										var options = $(this).data('twbsPagination').options;
								        options.baseUrl = options.baseUrl.replace('','');
								        options.getParams.page = page; 
//								        options.getParams.pagesize = options.getParams.pagesize;
                                        var param = '';
										for(var x in options.getParams ){
								        		param += '&' + x + '=' + options.getParams[x];
								        }
//										console.log(param);return;
										
								        window.location.href =  options.baseUrl + param + '';
								    }
							});
		$('#list-pagination').twbsPagination(paginationOptions);
		
	});
	function gradeChange(){
		var objS = document.getElementById("subjid");
	    var grade = objS.options[objS.selectedIndex].value;
	    var url = '{:U(index)}'+'&subjid='+grade;
		window.location.href = url;
		
		
	}
	</script>
<script type="text/javascript">
		$(function(){
			$("#all-check").click(function(){
			    if(this.checked){   
			        $(".checkbox-li").prop("checked", true);  
			    }else{   
					$(".checkbox-li").prop("checked", false);
			    } 
			})
			$(".sorting_1").click(function(){
				console.log(($(this).children("input").prop("checked")));
				if($(this).children("input").prop("checked")){
					$(this).children("input").prop("checked",false);
				}else{
					$(this).children("input").prop("checked",true);
				}
				
			})
		})
	</script>		
<?php
function diffdate($timestamp, $is_hour = 1, $is_minutes = 0){
    if(empty($timestamp) || $timestamp <= 60) {
        return false;
    }
 
    $time = time();
    $remain_time = $timestamp-$time;
 
    $day = floor($remain_time / (3600*24));
    $day = $day > 0 ? $day.'天' : '';
    $hour = floor(($remain_time % (3600*24)) / 3600);
    $hour = $hour > 0 ? $hour.'小时' : '';
    if($is_hour && $is_minutes) {
        $minutes = floor((($remain_time % (3600*24)) % 3600) / 60);
        $minutes = $minutes > 0 ? $minutes.'分' : '';
        return $day.$hour.$minutes;
    }
    if($hour) {
        return $day.$hour;
    }
    return $day;
}
?>	
	
</block>